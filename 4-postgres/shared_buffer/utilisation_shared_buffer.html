<!DOCTYPE html>
<html>

<head>
    <title>utilisation_shared_buffer.md</title>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    
<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

html,footer,header{
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Custom MD PDF CSS
 */
html,footer,header{
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";

 }
body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>
<link rel="stylesheet" href="file:///Users/mohamed/Documents/formation/postgres-hibernate-fdj/R%3A%5C2.Travail%5C1.Enseignement%5CCours%5C_1.Outils%5C2.Developpement%5C1.SCSS%5Cmain.css" type="text/css"><link rel="stylesheet" href="file:///Users/mohamed/Documents/formation/postgres-hibernate-fdj/D%3A%5Crdaros%5CCours%5C_1.Outils%5C2.Developpement%5C1.SCSS%5Cmain.css" type="text/css">
</head>

<body>
    <p>Le paramètre <code>shared_buffers</code> est l'un des paramètres les plus importants de PostgreSQL pour la gestion de la mémoire. Il détermine la quantité de mémoire que PostgreSQL alloue pour les buffers partagés, qui sont utilisés pour le cache des pages de données.</p>
<h3 id="comprendre-sharedbuffers">Comprendre <code>shared_buffers</code></h3>
<ol>
<li>
<p><strong>Qu'est-ce que <code>shared_buffers</code> ?</strong></p>
<ul>
<li><code>shared_buffers</code> est une zone de mémoire partagée entre tous les processus de PostgreSQL, utilisée pour stocker des pages de données récemment accédées. Il joue un rôle crucial dans la performance de la base de données car il réduit le nombre d'accès disque en maintenant les pages de données fréquemment accédées en mémoire.</li>
</ul>
</li>
<li>
<p><strong>Importance de <code>shared_buffers</code></strong></p>
<ul>
<li>Une configuration appropriée de <code>shared_buffers</code> peut améliorer considérablement les performances de votre base de données en réduisant les temps d'accès aux données. Cependant, une valeur trop élevée peut entraîner une utilisation excessive de la mémoire, ce qui pourrait nuire aux performances du système d'exploitation et des autres applications.</li>
</ul>
</li>
</ol>
<h3 id="configuration-de-sharedbuffers">Configuration de <code>shared_buffers</code></h3>
<ol>
<li>
<p><strong>Modifier le fichier <code>postgresql.conf</code></strong></p>
<p>Pour configurer <code>shared_buffers</code>, ouvrez le fichier de configuration <code>postgresql.conf</code> :</p>
<pre class="hljs"><code><div>sudo nano /etc/postgresql/14/main/postgresql.conf
</div></code></pre>
<p>Trouvez et modifiez la ligne <code>shared_buffers</code> pour définir la quantité de mémoire que vous souhaitez allouer. Par exemple, pour allouer 2 Go :</p>
<pre class="hljs"><code><div><span class="hljs-attr">shared_buffers</span> = <span class="hljs-number">2</span>GB
</div></code></pre>
<p>Si la ligne n'existe pas, ajoutez-la.</p>
</li>
<li>
<p><strong>Recommandations de Configuration</strong></p>
<ul>
<li><strong>Système dédié</strong> : Si PostgreSQL est exécuté sur un serveur dédié, une règle générale est de définir <code>shared_buffers</code> à environ 25% de la RAM totale du système. Par exemple, pour un serveur avec 16 Go de RAM, vous pouvez définir <code>shared_buffers</code> à 4 Go.</li>
<li><strong>Système partagé</strong> : Si le serveur exécute d'autres applications en plus de PostgreSQL, vous devrez ajuster cette valeur en conséquence pour éviter une contention excessive de la mémoire.</li>
</ul>
</li>
</ol>
<h3 id="exemple-de-calcul">Exemple de Calcul</h3>
<p>Pour un serveur avec 16 Go de RAM :</p>
<pre class="hljs"><code><div><span class="hljs-attr">shared_buffers</span> = <span class="hljs-number">4</span>GB  <span class="hljs-comment"># 25% de 16 Go</span>
</div></code></pre>
<p>Pour un serveur avec 8 Go de RAM :</p>
<pre class="hljs"><code><div><span class="hljs-attr">shared_buffers</span> = <span class="hljs-number">2</span>GB  <span class="hljs-comment"># 25% de 8 Go</span>
</div></code></pre>
<h3 id="recharger-ou-red%C3%A9marrer-postgresql">Recharger ou Redémarrer PostgreSQL</h3>
<p>Après avoir modifié <code>postgresql.conf</code>, vous devez recharger la configuration ou redémarrer le serveur PostgreSQL pour appliquer les modifications.</p>
<h4 id="recharger-la-configuration">Recharger la Configuration</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">SELECT</span> pg_reload_conf();
</div></code></pre>
<p>Ou avec <code>systemctl</code> :</p>
<pre class="hljs"><code><div>sudo systemctl reload postgresql
</div></code></pre>
<h4 id="red%C3%A9marrer-le-serveur">Redémarrer le Serveur</h4>
<pre class="hljs"><code><div>sudo systemctl restart postgresql
</div></code></pre>
<h3 id="surveillance-et-ajustement">Surveillance et Ajustement</h3>
<p>Après avoir configuré <code>shared_buffers</code>, il est important de surveiller les performances de votre base de données pour vous assurer que la configuration est optimale. Vous pouvez utiliser des outils comme <code>pg_stat_activity</code>, <code>pg_stat_database</code>, et <code>pg_buffercache</code> pour surveiller l'utilisation des buffers.</p>
<ol>
<li>
<p><strong>Vérifier l'utilisation des buffers</strong></p>
<p>Vous pouvez utiliser l'extension <code>pg_buffercache</code> pour obtenir des informations détaillées sur l'utilisation des buffers. Pour installer et utiliser cette extension :</p>
<pre class="hljs"><code><div><span class="hljs-keyword">CREATE</span> EXTENSION pg_buffercache;
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> pg_buffercache;
</div></code></pre>
</li>
<li>
<p><strong>Surveiller les statistiques de la base de données</strong></p>
<p>Utilisez la vue <code>pg_stat_database</code> pour surveiller les statistiques générales de la base de données :</p>
<pre class="hljs"><code><div><span class="hljs-keyword">SELECT</span>
    datname,
    numbackends,
    xact_commit,
    xact_rollback,
    blks_read,
    blks_hit,
    (blks_hit - blks_read) / blks_hit::<span class="hljs-built_in">float</span> <span class="hljs-keyword">AS</span> hit_ratio
<span class="hljs-keyword">FROM</span> pg_stat_database;
</div></code></pre>
</li>
</ol>

</body>

</html>